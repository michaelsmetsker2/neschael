#include <stdio.h>
#include <stdint.h>

#define META_SIZE (16 * 13) // mrow * mcol

// 8bit array of max size initialized to zero
uint8_t input[META_SIZE] = {0};

// array of match structs
struct {
	size_t length;
	size_t index;
} longest[META_SIZE];

// returns number of consecutive equal bytes
static size_t cmp(uint8_t const *const a, uint8_t const *const b, size_t len) {
	for (size_t i = 0; i < len; i++) {
		if (a[i] != b[i]) {
			return i;
		}
	}
	return len;
}

int main(void) {
  //fills in array with characters from stdin

  // fills input with data
	size_t length = fread(input, 1, META_SIZE, stdin);
	if (length != META_SIZE) {
		printf("length != expected size");
		return 1;
	}

	// find longest matches
  
	// look back 256 times to find the biggest match
	for (unsigned lookBack = 1; lookBack <= 256; lookBack++) {
        
		// i is the index of the pice of data we are looking at in the array
		for (size_t i = lookBack; i < length; i++) {

      // find the ammount of matching bytes starting from lookBack
			// skip through the matches then start analyzing again
			for (size_t len = cmp(input + i, input + i - lookBack, length - i); len > 0; len--, i++) {

				if (len > longest[i].length) {
					longest[i].length = len;
					longest[i].index = lookBack;
				}
			}
		}
	}

	// spit out compressed format
	setvbuf(stdout, NULL, _IOFBF, 0);

	for (size_t i = 0; i < length; ) {

		// count the ammount of consecutively unencoded litterals, up to 127
		size_t literals = 0;
		for (literals = 0; i < length && literals < 128; i++, literals++) {
			if (longest[i].length > 2) {
				break;
			}
		}

		// command byte containing the ammount of conecutive litterals
		putchar(256 - literals);
		// ouput all the conecutive litterals
		fwrite(input + i - literals, 1, literals, stdout);

		if (longest[i].length >= 2) {
			size_t matchLength = longest[i].length;
			if (matchLength > 128) {
				matchLength = 128;
			}

			// commant byte, length of the match 
			putchar(matchLength - 1);
			// command byte, how far back the start of the match is
			putchar((i - longest[i].index) & 0xff);
			i += matchLength;
		}
	}

	// end of stream flag
	putchar(0);
	fflush(stdout);
	return ferror(stdout);
}